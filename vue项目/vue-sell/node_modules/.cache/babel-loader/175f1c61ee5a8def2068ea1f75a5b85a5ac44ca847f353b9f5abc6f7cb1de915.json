{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, resolveComponent as _resolveComponent, createBlock as _createBlock, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, createElementVNode as _createElementVNode, normalizeClass as _normalizeClass, vShow as _vShow, withDirectives as _withDirectives, createVNode as _createVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-58de782f\"), n = n(), _popScopeId(), n;\n};\nvar _hoisted_1 = {\n  \"class\": \"goods\"\n};\nvar _hoisted_2 = {\n  \"class\": \"goods-content\"\n};\nvar _hoisted_3 = {\n  \"class\": \"menu-wrapper\",\n  ref: \"menuWrapper\"\n};\nvar _hoisted_4 = [\"onClick\"];\nvar _hoisted_5 = {\n  \"class\": \"text\"\n};\nvar _hoisted_6 = {\n  key: 0,\n  \"class\": \"bubble\"\n};\nvar _hoisted_7 = {\n  \"class\": \"num\"\n};\nvar _hoisted_8 = {\n  \"class\": \"foods-wrapper\",\n  ref: \"foodsWrapper\"\n};\nvar _hoisted_9 = {\n  \"class\": \"title\"\n};\nvar _hoisted_10 = {\n  \"class\": \"pic\"\n};\nvar _hoisted_11 = [\"src\"];\nvar _hoisted_12 = {\n  \"class\": \"content\"\n};\nvar _hoisted_13 = {\n  \"class\": \"name\"\n};\nvar _hoisted_14 = {\n  \"class\": \"desc\"\n};\nvar _hoisted_15 = {\n  \"class\": \"extra\"\n};\nvar _hoisted_16 = {\n  \"class\": \"count\"\n};\nvar _hoisted_17 = {\n  \"class\": \"price\"\n};\nvar _hoisted_18 = {\n  \"class\": \"price-context\"\n};\nvar _hoisted_19 = {\n  \"class\": \"now\"\n};\nvar _hoisted_20 = {\n  key: 0,\n  \"class\": \"cart-context\"\n};\nvar _hoisted_21 = [\"onClick\"];\nvar _hoisted_22 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_SupportIcon = _resolveComponent(\"SupportIcon\");\n  var _component_Cart = _resolveComponent(\"Cart\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.goods, function (item, index) {\n    return _openBlock(), _createElementBlock(\"li\", {\n      \"class\": _normalizeClass([\"menu-item\", {\n        'current': $options.currentIndex === index\n      }]),\n      key: index,\n      onClick: function onClick($event) {\n        return $options.selectMenu(index);\n      }\n    }, [_createElementVNode(\"span\", _hoisted_5, [item.type >= 0 ? (_openBlock(), _createBlock(_component_SupportIcon, {\n      key: 0,\n      size: \"3\",\n      type: item.type\n    }, null, 8 /* PROPS */, [\"type\"])) : _createCommentVNode(\"v-if\", true), _createTextVNode(\" \" + _toDisplayString(item.name), 1 /* TEXT */)]), $data.cartCountSum[index] > 0 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_6, [_createElementVNode(\"span\", _hoisted_7, _toDisplayString($data.cartCountSum[index]), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)], 10 /* CLASS, PROPS */, _hoisted_4);\n  }), 128 /* KEYED_FRAGMENT */))])], 512 /* NEED_PATCH */), _createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"ul\", null, [_createCommentVNode(\" 一个菜系 \"), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.goods, function (item, index1) {\n    return _openBlock(), _createElementBlock(\"li\", {\n      \"class\": \"food-list\",\n      key: index1,\n      ref_for: true,\n      ref: \"foodList\"\n    }, [_createElementVNode(\"h1\", _hoisted_9, _toDisplayString(item.name), 1 /* TEXT */), _createCommentVNode(\" 一道一道菜 \"), _createElementVNode(\"ul\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(item.foods, function (food, index2) {\n      return _openBlock(), _createElementBlock(\"li\", {\n        \"class\": \"food-item\",\n        key: index2\n      }, [_createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"img\", {\n        src: food.image\n      }, null, 8 /* PROPS */, _hoisted_11)]), _createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"h2\", _hoisted_13, _toDisplayString(food.name), 1 /* TEXT */), _createElementVNode(\"p\", _hoisted_14, _toDisplayString(food.description), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_15, [_createElementVNode(\"span\", _hoisted_16, \"月售\" + _toDisplayString(food.sellCount) + \"份\", 1 /* TEXT */), _createElementVNode(\"span\", null, \"好评率\" + _toDisplayString(food.rating) + \"%\", 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"div\", _hoisted_18, [_createElementVNode(\"span\", _hoisted_19, \"￥\" + _toDisplayString(food.price), 1 /* TEXT */), _withDirectives(_createElementVNode(\"span\", {\n        \"class\": \"old\"\n      }, \"￥\" + _toDisplayString(food.oldPrice), 513 /* TEXT, NEED_PATCH */), [[_vShow, food.oldPrice]])]), $data.cartCount[index1] ? (_openBlock(), _createElementBlock(\"div\", _hoisted_20, [_withDirectives(_createElementVNode(\"i\", {\n        \"class\": \"iconfont icon-jianshao\",\n        onClick: function onClick($event) {\n          return $options.reduceCart(index1, index2);\n        }\n      }, null, 8 /* PROPS */, _hoisted_21), [[_vShow, $data.cartCount[index1][index2].count]]), _withDirectives(_createElementVNode(\"span\", {\n        \"class\": \"cart-count\"\n      }, _toDisplayString($data.cartCount[index1][index2].count), 513 /* TEXT, NEED_PATCH */), [[_vShow, $data.cartCount[index1][index2].count]]), _createElementVNode(\"i\", {\n        \"class\": \"iconfont icon-jia\",\n        onClick: function onClick($event) {\n          return $options.addCart(index1, index2);\n        }\n      }, null, 8 /* PROPS */, _hoisted_22)])) : _createCommentVNode(\"v-if\", true)]), _createCommentVNode(\" + \")])]);\n    }), 128 /* KEYED_FRAGMENT */))])]);\n  }), 128 /* KEYED_FRAGMENT */))])], 512 /* NEED_PATCH */)]), _createVNode(_component_Cart, {\n    costList: $data.cartCountSum,\n    cartList: $data.cartFood\n  }, null, 8 /* PROPS */, [\"costList\", \"cartList\"])]);\n}","map":{"version":3,"names":["ref","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_Fragment","_renderList","$data","goods","item","index","_normalizeClass","$options","currentIndex","key","onClick","$event","selectMenu","_hoisted_5","type","_createBlock","_component_SupportIcon","size","_toDisplayString","name","cartCountSum","_hoisted_6","_hoisted_7","_hoisted_8","_createCommentVNode","index1","_hoisted_9","foods","food","index2","_hoisted_10","src","image","_hoisted_12","_hoisted_13","_hoisted_14","description","_hoisted_15","_hoisted_16","sellCount","rating","_hoisted_17","_hoisted_18","_hoisted_19","price","oldPrice","cartCount","_hoisted_20","reduceCart","count","addCart","_createVNode","_component_Cart","costList","cartList","cartFood"],"sources":["C:\\Users\\方鹏\\Desktop\\codingSpace\\vue项目\\vue-sell\\src\\views\\goods\\index.vue"],"sourcesContent":["<template>\n  <div class=\"goods\">\n    <div class=\"goods-content\">\n      <div class=\"menu-wrapper\" ref=\"menuWrapper\">\n        <ul>\n          <li \n            class=\"menu-item\" \n            :class=\"{'current' : currentIndex === index}\"\n            v-for=\"(item, index) in goods\" \n            :key=\"index\"\n            @click=\"selectMenu(index)\"\n          >\n            <span class=\"text\">\n              <SupportIcon size=\"3\" :type=\"item.type\" v-if=\"item.type >= 0\"/>\n              {{item.name}}\n            </span>\n            <span class=\"bubble\" v-if=\"cartCountSum[index] > 0\">\n                <span class=\"num\"> {{  cartCountSum[index] }}</span>\n            </span>\n          </li>\n        </ul>\n      </div>  \n      <div class=\"foods-wrapper\" ref=\"foodsWrapper\">\n        <ul>\n          <!-- 一个菜系 -->\n          <li class=\"food-list\" v-for=\"(item,index1) in goods\" :key=\"index1\" ref=\"foodList\">\n            <h1 class=\"title\">{{ item.name }}</h1>\n            <!-- 一道一道菜 -->\n            <ul>\n              <li class=\"food-item\"  v-for=\"(food,index2) in item.foods\" :key=\"index2\">\n                <div class=\"pic\">\n                  <img :src=\"food.image\">\n                </div>\n                <div class=\"content\">\n                  <h2 class=\"name\">{{ food.name }}</h2>\n                  <p class=\"desc\">{{ food.description }}</p>\n                  <div class=\"extra\">\n                    <span class=\"count\">月售{{ food.sellCount }}份</span>\n                    <span>好评率{{ food.rating }}%</span>\n                  </div>\n                  <div class=\"price\">\n                    <div class=\"price-context\">\n                      <span class=\"now\">￥{{ food.price }}</span>\n                      <span class=\"old\" v-show=\"food.oldPrice\">￥{{ food.oldPrice }}</span>\n                    </div>\n                    <div class=\"cart-context\" v-if=\"cartCount[index1]\">\n                      <i class=\"iconfont icon-jianshao\" v-show=\"cartCount[index1][index2].count\"  @click=\"reduceCart(index1,index2)\"></i>\n                      <span class=\"cart-count\" v-show=\"cartCount[index1][index2].count\">{{ cartCount[index1][index2].count }}</span>\n                      <i class=\"iconfont icon-jia\" @click=\"addCart(index1,index2)\"></i>\n                    </div>\n                  </div>\n                  <!-- + -->\n\n                </div>\n              </li>\n            </ul>\n          </li>\n        </ul>\n      </div>\n    </div>\n    \n    <Cart :costList=\"cartCountSum\" :cartList=\"cartFood\"/>\n  </div>\n</template>\n\n<script>\nimport { getGoods } from '@/api'\nimport SupportIcon from '@/components/support-icon/Support-icon.vue'\nimport BScroll from '@better-scroll/core'\nimport Cart from '@/components/cart/Cart.vue'\nexport default {\n  components: {\n    SupportIcon,\n    Cart\n  },\n  data() {\n    return {\n      goods: [],\n      foodList:[],//各菜系的食物dom结构\n      foodBScroll:[],\n      scrollY:0,\n      foodHeight:[],\n      cartCount:[],\n      cartCountSum:[],\n      cartFood:[],\n      foodNameList:[]\n    }\n  },\n  created() {\n    // 获取商品数据\n    getGoods().then(res => {\n      console.log(res);\n      this.goods = res\n      \n      this.$nextTick(() => { // $nextTick里面的回调会在页面加载完毕之后才执行\n        this.betterScroll()\n        this.getFoodHeight()\n        this.goods.forEach((item)=>{\n          const arr = []\n          item.foods.forEach((food)=>{ arr.push({\n            food,\n            count: 0\n          })})\n          this.cartCountSum.push(0)\n          this.cartCount.push(arr)\n        })\n      })\n    })\n  },\n  methods: {\n    betterScroll() {\n      // 获取到menu-wrapper的dom结构\n      new BScroll(this.$refs.menuWrapper, {\n        click: true\n      })\n      this.foodBScroll = new BScroll(this.$refs.foodsWrapper, {\n        click: true,\n        scroll: true,\n        probeType:3\n      })\n      this.foodList = this.$refs.foodList\n      this.foodBScroll.on('scroll',(pos)=>{\n      this.scrollY = Math.round(Math.abs(pos.y))\n      })\n    },\n    selectMenu(i) {\n      // console.log(i);\n      this.currentIndex = i\n      this.foodBScroll.scrollToElement(this.foodList[i],500)\n    },\n    getFoodHeight(){\n      let height = 0\n      this.foodHeight.push(height)\n      this.foodList.forEach((foodheight)=>{\n        height += foodheight.clientHeight\n        this.foodHeight.push(height)\n      })\n      console.log(this.foodHeight);\n    },\n    addCart(MenuID,foodID){\n      this.cartCount[MenuID][foodID].count++\n      this.cartCountSum[MenuID]++\n      const foodname = this.goods[MenuID].name + this.goods[MenuID].foods[foodID].name \n      if(!this.foodNameList.includes(foodname)){\n        this.foodNameList.push(foodname)\n        this.cartFood.push(this.cartCount[MenuID][foodID])\n      }\n    },\n    reduceCart(MenuID,foodID){\n      this.cartCount[MenuID][foodID].count--\n      this.cartCountSum[MenuID]--\n    },\n  },\n  computed:{\n   currentIndex(){\n    //随着右侧滚动this.scrollY返回不同的下标\n    for(let i = 0; i < this.foodHeight.length; i++){\n      const h1 = this.foodHeight[i]\n      const h2 = this.foodHeight[i+1]\n      if(!h2||(this.scrollY >= h1 && this.scrollY < h2)){\n        return i\n      }\n    }\n   }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n@import '@/common/style/variable.less';\n.goods{\n  position: absolute;\n  width: 100%;\n  bottom: 46px;\n  top: 177px;\n  overflow: hidden;\n  &-content{\n    display: flex;\n    height: 100%;\n    .menu-wrapper{\n      flex: 0 0 80px;\n      background: @color-background-ssss;\n      .menu-item{\n        padding: 0 10px;\n        font-size: @fontsize-small;\n        height: 54px;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        position: relative;\n        &.current{\n          background: #fff;\n          font-weight: 700;\n        }\n        .bubble{\n          background: linear-gradient(90deg,#fc9153,#f01414);\n          border-radius: 16px;\n          color: #fff;\n          font-family: Helvetica;\n          font-size: 10px;\n          font-weight: 700;\n          line-height: 16px;\n          padding: 0 5px;\n          text-align: center;\n          position: absolute;\n          right: 2px;\n          top: 6px;\n        }\n      }\n    }\n    .foods-wrapper{\n      flex: 1;\n      .title{\n        height: 26px;\n        line-height: 26px;\n        font-size: @fontsize-small;\n        color: rgb(147, 153, 159);\n        background: @color-background-ssss;\n        padding-left: 14px;\n        border-left: 2px solid #d9dde1;\n      }\n      .food-item{\n        display: flex;\n        padding-bottom: 18px;\n        margin: 18px;\n        .pic{\n          flex: 0 0 57px;\n          margin-right: 10px;\n          img{\n            width: 100%;\n          }\n        }\n        .content{\n          flex: 1;\n          .name{\n            font-size: @fontsize-medium;\n            color: rgb(7, 17, 27);\n            margin: 2px 0 8px 0;\n          }\n          .desc, .extra{\n            font-size: @fontsize-small-s;\n            color: rgb(147, 153, 159);\n            margin-bottom: 8px;\n            line-height: 10px;\n            .count{\n              margin-right: 12px;\n            }\n          }\n          .extra{\n            margin-bottom: 0px;\n            }\n          .price{\n            display: flex;\n            font-weight: 700;\n            line-height: 24px;\n            height: 24px;\n            justify-content: space-between;\n            // align-items: center;\n\n            .price-context{\n              .now{\n              font-size: @fontsize-medium;\n              color: @color-red;\n              margin-right: 8px;\n            }\n            .old{\n              font-size: @fontsize-small-s;\n              color: rgb(147, 153, 159);\n              text-decoration: line-through;\n            }\n            }\n           \n            .cart-context{\n            margin-top: -2px;\n              .iconfont{\n              color: #00a0dc;\n              font-size: 22px;\n              padding: 6px;\n              vertical-align: middle;\n            }\n            .cart-count{\n              display: inline-block;\n              color: #8e8e8e;\n              font-size: 10px;\n              width: 12px;\n              text-align: center;\n            }\n            }\n            \n          }\n        }\n      }\n    }\n  }\n}\n\n.food-item&:last-child { \n  padding-bottom: 0px !important;\n  margin: 0px;\n  background-color: #ff0000;\n}\n\n\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}